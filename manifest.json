{
  "name": "aide-leglength-ensemble",
  "label": "LPCH Pediatric Leg Length Algorithm (w/ Ensemble)",
  "description": "Advanced leg length measurement system with ensemble inference and uncertainty quantification. Supports single model or multi-model consensus analysis with confidence-weighted fusion, derived point calculations, and comprehensive clinical reporting.",
  "version": "0.1.3",
  "author": "Arogya Koirala",
  "maintainer": "Arogya Koirala <arogya@stanford.edu>",
  "cite": "",
  "license": "Apache-2.0",
  "url": "",
  "source": "",
  "environment": {
    "FLYWHEEL": "/flywheel/v0",
    "PYTHONIOENCODING": "utf-8",
    "PYTHON_PIP_VERSION": "24.0",
    "PYTHONUNBUFFERED": "1",
    "GPG_KEY": "7169605F62C751356D054A26A821E680E5FA6305",
    "TORCH_HOME": "/flywheel/v0/.cache",
    "PYTHONDONTWRITEBYTECODE": "1",
    "PIP_DISABLE_PIP_VERSION_CHECK": "1",
    "PYTHON_GET_PIP_URL": "https://github.com/pypa/get-pip/raw/dbf0c85f76fb6e1ab42aa672ffca6f0a675d9ee4/public/get-pip.py",
    "PATH": "/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
    "PIP_NO_CACHE_DIR": "1",
    "LANG": "C.UTF-8",
    "DEBIAN_FRONTEND": "noninteractive",
    "PYTHON_VERSION": "3.12.3",
    "LC_ALL": "C.UTF-8",
    "PWD": "/flywheel/v0",
    "PYTHON_GET_PIP_SHA256": "dfe9fd5c28dc98b5ac17979a953ea550cec37ae1b47a5116007395bfacff2ab9"
  },
  "custom": {
    "gear-builder": {
      "category": "analysis",
      "image": "stanfordaide/aide-leglength:0.1.3"
    },
    "flywheel": {
      "suite": "Flywheel Training Gears"
    }
  },
  "inputs": {
    "dicom_in": {
      "description": "DICOM radiograph file containing leg X-ray for landmark detection and measurement analysis",
      "base": "file",
      "type": {
        "enum": [
          "dicom"
        ]
      }
    }
  },
  "config": {
    "mode": {
      "description": "Analysis mode: 'single' for single model inference or 'ensemble' for multi-model consensus with uncertainty quantification",
      "type": "string",
      "enum": [
        "single",
        "ensemble"
      ],
      "default": "single"
    },
    "model": {
      "description": "Deep learning model backbone for single mode analysis. ConvNeXt and ResNeXt recommended for best performance.",
      "type": "string",
      "enum": [
        "resnext101_32x8d",
        "convnext_base",
        "vit_l_16",
        "densenet201",
        "resnet101",
        "efficientnet_v2_m",
        "mobilenet_v3_large",
        "swin_v2_b"
      ],
      "default": "resnext101_32x8d"
    },
    "ensemble_models": {
      "description": "Array of models to use for ensemble analysis. More models provide better uncertainty estimates but require longer processing time.",
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "resnext101_32x8d",
          "convnext_base",
          "vit_l_16",
          "densenet201",
          "resnet101",
          "efficientnet_v2_m",
          "mobilenet_v3_large",
          "swin_v2_b"
        ]
      },
      "default": [
        "resnet101",
        "efficientnet_v2_m",
        "mobilenet_v3_large"
      ],
      "minItems": 2,
      "maxItems": 5,
      "uniqueItems": true
    },
    "confidence_threshold": {
      "description": "Minimum confidence score (0.0-1.0) for accepting landmark predictions. Lower values include more detections but may reduce accuracy.",
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.1
    },
    "best_per_class": {
      "description": "Return only the highest confidence prediction for each anatomical landmark. Recommended for clinical use.",
      "type": "boolean",
      "default": true
    },
    "enable_disagreement": {
      "description": "Calculate disagreement metrics between ensemble models for uncertainty quantification. Only applies to ensemble mode.",
      "type": "boolean",
      "default": true
    },
    "detection_weight": {
      "description": "Weight (0.0-1.0) for detection disagreement in overall uncertainty score. Higher values emphasize whether all models detect the same landmarks.",
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.5
    },
    "outlier_weight": {
      "description": "Weight (0.0-1.0) for outlier risk in overall uncertainty score. Higher values emphasize spatial consistency between models.",
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.35
    },
    "localization_weight": {
      "description": "Weight (0.0-1.0) for localization disagreement in overall uncertainty score. Higher values emphasize precise landmark positioning.",
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.15
    }
  },
  "command": "python3 run.py"
}