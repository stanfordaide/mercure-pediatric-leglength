<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" style="background-color: white;">
  <defs>
    <!-- Define gradients and styles -->
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e1f5fe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b3e5fc;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="singleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ffe0b2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ensembleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f3e5f5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e1bee7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f5e8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c8e6c9;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect x="0" y="0" width="1200" height="900" fill="white" stroke="#ddd" stroke-width="2"/>

  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    Unified Leg Length Detection Workflow
  </text>

  <!-- Input Section -->
  <rect x="500" y="60" width="200" height="60" rx="10" fill="url(#inputGrad)" stroke="#333" stroke-width="2"/>
  <text x="600" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    Input: DICOM Image
  </text>
  <text x="600" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#555">
    X-ray with 8 anatomical points
  </text>

  <!-- Decision Diamond -->
  <polygon points="600,150 650,180 600,210 550,180" fill="#fff9c4" stroke="#333" stroke-width="2"/>
  <text x="600" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">
    Mode?
  </text>

  <!-- Single Model Path -->
  <rect x="250" y="250" width="200" height="60" rx="10" fill="url(#singleGrad)" stroke="#333" stroke-width="2"/>
  <text x="350" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    Single Model Inference
  </text>
  <text x="350" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#555">
    ResNeXt/ConvNeXt/ViT
  </text>

  <rect x="250" y="340" width="200" height="60" rx="10" fill="#fff" stroke="#333" stroke-width="2"/>
  <text x="350" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">
    Convert to Unified Format
  </text>
  <text x="350" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    create_single_model_prediction()
  </text>

  <!-- Ensemble Model Path -->
  <rect x="750" y="250" width="200" height="60" rx="10" fill="url(#ensembleGrad)" stroke="#333" stroke-width="2"/>
  <text x="850" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    Ensemble Inference
  </text>
  <text x="850" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#555">
    Multiple Models
  </text>

  <!-- Individual Models -->
  <rect x="680" y="340" width="80" height="40" rx="5" fill="#e3f2fd" stroke="#333" stroke-width="1"/>
  <text x="720" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">ConvNeXt</text>

  <rect x="780" y="340" width="80" height="40" rx="5" fill="#e3f2fd" stroke="#333" stroke-width="1"/>
  <text x="820" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">ResNeXt</text>

  <rect x="880" y="340" width="80" height="40" rx="5" fill="#e3f2fd" stroke="#333" stroke-width="1"/>
  <text x="920" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">ViT</text>

  <!-- Fusion Process -->
  <rect x="750" y="410" width="200" height="60" rx="10" fill="#fff" stroke="#333" stroke-width="2"/>
  <text x="850" y="435" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">
    Confidence-Weighted Fusion
  </text>
  <text x="850" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    fuse_ensemble_predictions()
  </text>

  <rect x="750" y="490" width="200" height="40" rx="10" fill="#fff" stroke="#333" stroke-width="1"/>
  <text x="850" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">
    Calculate Uncertainty & Disagreement
  </text>

  <!-- Unified Processing -->
  <rect x="450" y="580" width="300" height="60" rx="10" fill="#f5f5f5" stroke="#333" stroke-width="2"/>
  <text x="600" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    Unified Output Generation
  </text>
  <text x="600" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#555">
    Derived Points + Measurements + Visualizations
  </text>

  <!-- Three Output Files -->
  <rect x="100" y="700" width="280" height="120" rx="10" fill="url(#outputGrad)" stroke="#333" stroke-width="2"/>
  <text x="240" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    1. QA Visualization (DICOM)
  </text>
  <text x="240" y="745" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Uncertainty color coding
  </text>
  <text x="240" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Error bars and circles
  </text>
  <text x="240" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Measurement overlays
  </text>
  <text x="240" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Interactive legend
  </text>
  <text x="240" y="805" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Ensemble metadata
  </text>

  <rect x="400" y="700" width="280" height="120" rx="10" fill="url(#outputGrad)" stroke="#333" stroke-width="2"/>
  <text x="540" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    2. Secondary Capture (DICOM)
  </text>
  <text x="540" y="745" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Structured measurements
  </text>
  <text x="540" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Problematic points
  </text>
  <text x="540" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Model agreements
  </text>
  <text x="540" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Clinical metadata
  </text>
  <text x="540" y="805" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Quality assessment
  </text>

  <rect x="700" y="700" width="280" height="120" rx="10" fill="url(#outputGrad)" stroke="#333" stroke-width="2"/>
  <text x="840" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    3. JSON Report
  </text>
  <text x="840" y="745" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Point uncertainties
  </text>
  <text x="840" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Quality scores
  </text>
  <text x="840" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Clinical recommendations
  </text>
  <text x="840" y="790" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Disagreement metrics
  </text>
  <text x="840" y="805" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#555">
    • Comprehensive statistics
  </text>

  <!-- Arrows -->
  <!-- Input to Decision -->
  <line x1="600" y1="120" x2="600" y2="150" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Decision to Single -->
  <line x1="550" y1="180" x2="450" y2="180" stroke="#333" stroke-width="2"/>
  <line x1="450" y1="180" x2="450" y2="250" stroke="#333" stroke-width="2"/>
  <line x1="450" y1="250" x2="350" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="480" y="175" font-family="Arial, sans-serif" font-size="12" fill="#333">Single</text>
  
  <!-- Decision to Ensemble -->
  <line x1="650" y1="180" x2="750" y2="180" stroke="#333" stroke-width="2"/>
  <line x1="750" y1="180" x2="750" y2="250" stroke="#333" stroke-width="2"/>
  <line x1="750" y1="250" x2="850" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="680" y="175" font-family="Arial, sans-serif" font-size="12" fill="#333">Ensemble</text>
  
  <!-- Single flow -->
  <line x1="350" y1="310" x2="350" y2="340" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Ensemble flow -->
  <line x1="850" y1="310" x2="850" y2="340" stroke="#333" stroke-width="2"/>
  <line x1="720" y1="380" x2="720" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="820" y1="380" x2="820" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="920" y1="380" x2="920" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="720" y1="395" x2="810" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="820" y1="395" x2="820" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="830" y1="395" x2="920" y2="395" stroke="#333" stroke-width="1"/>
  <line x1="820" y1="395" x2="820" y2="410" stroke="#333" stroke-width="2"/>
  <line x1="820" y1="410" x2="850" y2="410" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <line x1="850" y1="470" x2="850" y2="490" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Convergence to unified -->
  <line x1="350" y1="400" x2="350" y2="560" stroke="#333" stroke-width="2"/>
  <line x1="350" y1="560" x2="550" y2="560" stroke="#333" stroke-width="2"/>
  <line x1="550" y1="560" x2="550" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <line x1="850" y1="530" x2="850" y2="560" stroke="#333" stroke-width="2"/>
  <line x1="850" y1="560" x2="650" y2="560" stroke="#333" stroke-width="2"/>
  <line x1="650" y1="560" x2="650" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Unified to outputs -->
  <line x1="500" y1="640" x2="240" y2="640" stroke="#333" stroke-width="2"/>
  <line x1="240" y1="640" x2="240" y2="700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <line x1="600" y1="640" x2="600" y2="680" stroke="#333" stroke-width="2"/>
  <line x1="600" y1="680" x2="540" y2="680" stroke="#333" stroke-width="2"/>
  <line x1="540" y1="680" x2="540" y2="700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <line x1="700" y1="640" x2="840" y2="640" stroke="#333" stroke-width="2"/>
  <line x1="840" y1="640" x2="840" y2="700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Legend -->
  <rect x="20" y="20" width="160" height="120" rx="5" fill="#f9f9f9" stroke="#333" stroke-width="1"/>
  <text x="100" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">
    Key Features
  </text>
  <text x="30" y="55" font-family="Arial, sans-serif" font-size="10" fill="#333">• Derived points support</text>
  <text x="30" y="70" font-family="Arial, sans-serif" font-size="10" fill="#333">• Confidence-weighted fusion</text>
  <text x="30" y="85" font-family="Arial, sans-serif" font-size="10" fill="#333">• Uncertainty visualization</text>
  <text x="30" y="100" font-family="Arial, sans-serif" font-size="10" fill="#333">• Identical output format</text>
  <text x="30" y="115" font-family="Arial, sans-serif" font-size="10" fill="#333">• Clinical recommendations</text>
  <text x="30" y="130" font-family="Arial, sans-serif" font-size="10" fill="#333">• Disagreement analysis</text>
</svg> 